import React, { useState, useEffect } from 'react';
import { Search, MapPin, Clock, Shield, Star, ChefHat, Building, X } from 'lucide-react';

const StealthKitchensApp = () => {
  const [userType, setUserType] = useState(null);
  const [currentView, setCurrentView] = useState('landing');
  const [selectedKitchen, setSelectedKitchen] = useState(null);
  
  // Persistent color scheme
  const [colorScheme, setColorScheme] = useState(() => {
    if (typeof window !== 'undefined') {
      return localStorage.getItem('stealth-color-scheme') || 'warm';
    }
    return 'warm';
  });

  useEffect(() => {
    localStorage.setItem('stealth-color-scheme', colorScheme);
  }, [colorScheme]);

  // Close modal on Escape or outside click
  useEffect(() => {
    const handleEsc = (e) => {
      if (e.key === 'Escape') setSelectedKitchen(null);
    };
    const handleOutsideClick = (e) => {
      if (selectedKitchen && !e.target.closest('.modal-content')) {
        setSelectedKitchen(null);
      }
    };
    if (selectedKitchen) {
      document.addEventListener('keydown', handleEsc);
      document.addEventListener('mousedown', handleOutsideClick);
    }
    return () => {
      document.removeEventListener('keydown', handleEsc);
      document.removeEventListener('mousedown', handleOutsideClick);
    };
  }, [selectedKitchen]);

  const colorSchemes = { /* ... your full colorSchemes object stays exactly the same */ };

  const currentColors = colorSchemes[colorScheme];

  const kitchens = [ /* ... your kitchens array stays the same */ ];

  // LandingPage, Marketplace, OwnerDashboard unchanged except minor responsive tweaks

  const LandingPage = () => (
    <div className="min-h-screen bg-white">
      {/* Header */}
      <nav className="px-6 py-8">
        <div className="max-w-6xl mx-auto flex justify-between items-center">
          <div className="text-2xl font-serif text-black">The Stealth Kitchens</div>
          <div className="flex items-center space-x-4">
            <div className="text-xs text-gray-400 font-mono">POWERED BY KITCHE</div>
            <select 
              value={colorScheme} 
              onChange={(e) => setColorScheme(e.target.value)}
              className="text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:border-black bg-white"
            >
              {Object.entries(colorSchemes).map(([key, scheme]) => (
                <option key={key} value={key}>{scheme.name}</option>
              ))}
            </select>
          </div>
        </div>
      </nav>

      {/* Hero */}
      <div className="relative max-w-5xl mx-auto px-6 py-20 text-center">
        {/* Accents unchanged */}
        <div className={`absolute top-12 left-12 w-3 h-3 ${currentColors.hero.accent1} rounded-full opacity-40`}></div>
        {/* ... other accents */}

        <div className={`inline-flex items-center px-3 py-1 \( {currentColors.hero.statusBg} rounded-full text-sm \){currentColors.hero.statusText} mb-12 border`}>
          <div className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
          Live in Orange County
        </div>
        
        <h1 className="text-6xl sm:text-7xl md:text-8xl font-serif text-black mb-8 leading-none">
          <span className="relative">Book.<br /></span>
          <span className="relative">Cook.<br /></span>
          <span className="relative">Done.</span>
        </h1>

        {/* Rest of LandingPage unchanged — only hero text size fixed */}
      </div>

      {/* Two Paths — added subtle scale */}
      <div className="bg-gray-50 py-20">
        <div className="max-w-4xl mx-auto px-6">
          <div className="grid md:grid-cols-2 gap-12">
            <div 
              onClick={() => {setUserType('entrepreneur'); setCurrentView('marketplace');}}
              className="group cursor-pointer bg-white p-8 rounded-2xl hover:shadow-xl hover:scale-[1.02] transition-all duration-300 relative overflow-hidden"
            >
              {/* ... rest identical */}
            </div>
            <div 
              onClick={() => {setUserType('owner'); setCurrentView('owner-dashboard');}}
              className="group cursor-pointer bg-white p-8 rounded-2xl hover:shadow-xl hover:scale-[1.02] transition-all duration-300 relative overflow-hidden"
            >
              {/* ... rest identical */}
            </div>
          </div>
        </div>
      </div>

      {/* Trust & CTA unchanged */}
    </div>
  );

  const Marketplace = () => (
    <div className="min-h-screen bg-white">
      {/* Nav unchanged */}

      <div className="max-w-6xl mx-auto px-6 py-8">
        {/* Search unchanged */}

        <div className="grid lg:grid-cols-3 md:grid-cols-2 gap-6">
          {kitchens.map((kitchen) => (
            <div
              key={kitchen.id}
              onClick={() => setSelectedKitchen(kitchen)}
              className="group cursor-pointer bg-white border border-gray-200 rounded-xl p-6 hover:border-black hover:shadow-xl hover:scale-[1.02] transition-all duration-300"
            >
              {/* Card content unchanged */}
            </div>
          ))}
        </div>
      </div>

      {/* Fixed Modal */}
      {selectedKitchen && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
          <div className="modal-content bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            <div className="p-6 border-b sticky top-0 bg-white z-10 flex justify-between items-start">
              <div>
                <h2 className="text-2xl font-serif mb-2">{selectedKitchen.name}</h2>
                <p className="text-gray-600">{selectedKitchen.type} • {selectedKitchen.location}</p>
              </div>
              <button 
                onClick={() => setSelectedKitchen(null)}
                className="text-gray-400 hover:text-gray-800 transition-colors p-1"
              >
                <X className="w-6 h-6" />
              </button>
            </div>
            
            {/* Modal body unchanged */}
          </div>
        </div>
      )}
    </div>
  );

  const OwnerDashboard = () => (
    // unchanged — already perfect
  );

  if (currentView === 'marketplace') return <Marketplace />;
  if (currentView === 'owner-dashboard') return <OwnerDashboard />;
  return <LandingPage />;
};

export default StealthKitchensApp;
